<div ng-controller="ClassificationPluginCtrl"
     class="error-classification-content">
  <ul class="list-unstyled failure-line-list">

    <li ng-repeat="line in failureLines"
        class="failure-line"
        ng-class="{'classified-line': line.best_classification }">
      <div class="failure-line-detail">
        <button ng-if="!line.best_is_verified"
                class="btn btn-xs btn-default"
                title="Select best match and click here"
                ng-disabled="!canSave(line)"
                ng-click="save(line)">{{getSaveButtonText(line)}}</button>
        <span ng-if="line.best_is_verified">
            <span ng-if="!isLineIgnored(line)"
                  class="label label-xs label-primary"
                  title="This classification is verified">Verified</span>

            <span ng-if="isLineIgnored(line)"
                  class="label label-xs label-ignored"
                  title="This line is ignored">Ignored</span>
        </span>
        <span ng-if="line.action === 'test_result'">
          <span ng-class="{'ignored-line': (isLineIgnored(line))}">
            <span ng-bind-html="line | expectedString"></span>
            | <strong>{{line.test}}</strong>
            <span ng-if="line.subtest">| {{line.subtest}}</span>
          </span>
          <div ng-if="line.message && !isLineIgnored(line)"
               ng-init="messageExpanded=false"
               class="failure-line-message">
            <span class="failure-line-message-toggle fa fa-fw fa-lg"
                  ng-class="{'fa-caret-down': messageExpanded, 'fa-caret-right': !messageExpanded}"
                  ng-click="messageExpanded = !messageExpanded"></span>
            <span ng-if="!messageExpanded"
                  class="failure-line-message-collapsed">{{ line.message }}</span>
            <span ng-if="messageExpanded"
                  class="failure-line-message-expanded">{{ line.message }}</span>
          </div>
        </span>
        <span ng-if="line.action === 'log'">
          LOG {{line.level}} | {{line.message}}
        </span>
        <span ng-if="line.action === 'crash'">
          CRASH | {{line.signature}}
        </span>
        <span ng-if="line.action === ''">
          CRASH | {{line.signature}}
        </span>

        <div ng-if="line.best_is_verified && !isLineIgnored(line)">
          <span class="glyphicon glyphicon-star best-classification-star"></span>
          <span class="line-option-text" ng-if="line.ui.best.bug_number">
            <a href="{{::getBugUrl(line.ui.best.bug_number) }}"
               target="_blank">Bug {{::line.ui.best.bug_number}} -
              <span ng-if="line.ui.best.bug_summary"
                    ng-bind-html="line.ui.best.bug_summary |  escapeHTML | highlightCommonTerms:line.test:line.subtest:line.status:line.expected"></span>
            </a>
          </span>
        </div>

        <ul class="list-unstyled"
            ng-if="!line.best_is_verified">
          <!--classification options for line-->
          <li ng-repeat="option in line.ui.options" >
            <div class="classification-options">
              <div class="classification-icon">
                <span ng-if="option.icon_type == 'autoclassified'"
                      class="glyphicon glyphicon-star-empty"
                      title="This is the option Treeherder chose as the best"></span>
                <span ng-if="option.icon_type == 'none'"
                      class="classification-no-icon">&nbsp;</span>
              </div>
              <input type="radio"
                     value="{{$index}}"
                     name="{{::line.id}}"
                     ng-model="line.ui.selectedOption" />
              <span class="line-option-text" ng-if="option.bug_number">
                <a href="{{::getBugUrl(option.bug_number) }}"
                   target="_blank">Bug {{::option.bug_number}} -
                  <span ng-if="option.bug_summary"
                        ng-bind-html="option.bug_summary | escapeHTML | highlightCommonTerms:line.test:line.subtest:line.status:line.expected"></span>
                </a>
              </span>
              <span ng-if="option.type==='ignore'"
                    class="line-option-text"
                    title="Ignore this line with regard to job classification"> Ignore this line</span>
              <span ng-if="option.bug_number===null">
                <input class="manual-bug-input"
                       type="text"
                       placeholder="Enter a bug number"
                       title="This 'best match' does not yet have a bug number.  Please enter one."
                       ng-model="manualBugs[line.id]"/>
              </span>
            </div>
            <div class="classification-matchers" ng-if="option.type == 'classified_failure'">
              Matched by:
              <span ng-repeat='match in option.matches'>
                {{match.matcher.name}} ({{match.score}})
              </span>
              <a target="th_similar" ng-href="/failureviewer.html#/?classified_failure_id={{option.id}}">Other matching failures...</a>
            </div>
          </li>
        </ul>
      </div>
    </li>

    <li ng-if="!tabs.autoClassification.is_loading &&  !failureLines.length">
      <span>No classifiable errors for this job.</span>
    </li>
  </ul>

  <div class="failure-lines-save-all" ng-if="tabs.autoClassification.is_loading || failureLines.length">
    <button ng-if="failureLines"
            class="btn btn-primary btn-sm"
            title="Save All"
            ng-disabled="!canSaveAll(line)"
            ng-click="saveAll()">Save All</button>
  </div>

</div>
